# 中医脉象九宫格数据格式规范

## 概述
本文档定义了中医脉象九宫格图像的数据格式和标注规范，用于DeepSeek-OCR模型的微调训练。

## 九宫格结构

### 布局定义
九宫格将脉象信息分为3x3的网格结构：

```
┌─────────────┬─────────────┬─────────────┐
│   位置1     │   位置2     │   位置3     │
│  左寸(心)   │  左关(肝)   │  左尺(肾)   │
├─────────────┼─────────────┼─────────────┤
│   位置4     │   位置5     │   位置6     │
│  右寸(肺)   │  右关(脾)   │  右尺(肾)   │
├─────────────┼─────────────┼─────────────┤
│   位置7     │   位置8     │   位置9     │
│  总体评价   │  脉象特征   │  诊断建议   │
└─────────────┴─────────────┴─────────────┘
```

### 位置说明
1. **左寸(心)** - 左手寸部，对应心脏
2. **左关(肝)** - 左手关部，对应肝脏
3. **左尺(肾)** - 左手尺部，对应肾脏
4. **右寸(肺)** - 右手寸部，对应肺部
5. **右关(脾)** - 右手关部，对应脾脏
6. **右尺(肾)** - 右手尺部，对应肾脏
7. **总体评价** - 整体脉象描述
8. **脉象特征** - 特殊脉象特征
9. **诊断建议** - 基于脉象的诊断建议

## 数据格式

### 图像文件命名规范
- 格式：`{patient_id}_{date}_{sequence}.jpg`
- 示例：`P001_20240115_001.jpg`
- 要求：
  - `patient_id`: 患者ID，字母+数字组合
  - `date`: 采集日期，YYYYMMDD格式
  - `sequence`: 序列号，3位数字

### 标注文件格式
标注文件采用JSON格式，每个图像对应一个标注文件。

#### 标注文件结构
```json
{
  "image_info": {
    "file_name": "P001_20240115_001.jpg",
    "width": 800,
    "height": 600,
    "format": "jpg",
    "created_at": "2024-01-15T10:30:00"
  },
  "annotations": [
    {
      "grid_id": 1,
      "position": "左寸(心)",
      "text": "脉象文字内容",
      "bbox": [x, y, width, height],
      "attributes": {
        "pulse_type": "浮脉/沉脉/迟脉/数脉/虚脉/实脉",
        "strength": "强/中/弱",
        "rhythm": "齐/不齐",
        "confidence": 0.95
      }
    }
  ],
  "metadata": {
    "annotator": "医生姓名",
    "annotation_date": "2024-01-15T11:00:00",
    "version": "1.0"
  }
}
```

#### 字段说明

**image_info**
- `file_name`: 图像文件名
- `width`: 图像宽度（像素）
- `height`: 图像高度（像素）
- `format`: 图像格式
- `created_at`: 图像创建时间

**annotations** (数组，包含9个元素)
- `grid_id`: 九宫格位置ID (1-9)
- `position`: 位置名称
- `text`: 该位置的文本内容
- `bbox`: 边界框坐标 [x, y, width, height]
- `attributes`: 附加属性
  - `pulse_type`: 脉象类型
  - `strength`: 脉象强弱
  - `rhythm`: 脉律
  - `confidence`: 标注置信度

**metadata**
- `annotator`: 标注者姓名
- `annotation_date`: 标注时间
- `version`: 数据格式版本

### 脉象类型分类

#### 基本脉象
- **浮脉**：轻取即得，重按稍减
- **沉脉**：轻取不应，重按始得
- **迟脉**：一息不足四至
- **数脉**：一息五至以上
- **虚脉**：三部脉举之无力，按之空虚
- **实脉**：三部脉举按均有力

#### 复合脉象
- **滑脉**：往来流利，如珠走盘
- **涩脉**：往来艰涩，如轻刀刮竹
- **弦脉**：端直以长，如按琴弦
- **细脉**：脉细如线，应指明显
- **洪脉**：脉体宽大，充实有力
- **微脉**：极细极软，按之欲绝

## 标注指南

### 标注流程
1. **图像预处理**：确保图像清晰，九宫格边界明确
2. **网格识别**：识别并标注九宫格边界
3. **文本标注**：对每个网格内的文本进行标注
4. **属性标注**：标注脉象类型、强弱、节律等属性
5. **质量检查**：检查标注完整性和准确性

### 标注要求
- **完整性**：9个网格都必须有标注
- **准确性**：文本内容必须与图像完全一致
- **一致性**：相同类型的脉象使用统一的描述
- **规范性**：遵循本规范定义的格式和标准

### 质量控制
- 每个标注文件需要经过至少2人审核
- 标注置信度低于0.8的需要重新审核
- 定期抽样检查标注质量

## 数据存储结构

```
data/
├── raw/                          # 原始图像
│   ├── P001_20240115_001.jpg
│   ├── P001_20240115_002.jpg
│   └── ...
├── processed/                    # 预处理后的图像
│   ├── P001_20240115_001_preprocessed.jpg
│   └── ...
└── annotations/                  # 标注文件
    ├── P001_20240115_001.json
    ├── P001_20240115_002.json
    └── ...
```

## 版本历史
- v1.0 (2024-01-15): 初始版本